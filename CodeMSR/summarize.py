import pandas as pd
import os

dir = "ml_results_single_folds_1"
files = []

for path in os.listdir(dir):
    if str(path).startswith("result"):
        print(path)
        files.append(f"{dir}/{path}")

df = pd.concat(map(pd.read_csv, files))
df.columns = ["problem", "partition", "granularity", "scope", "feature", "classifier",
              "parameters", "val_acc", "val_prec", "val_rec", "val_gmean", "val_f1",
              "val_mcc", "train_time", "val_time", "test_acc","test_prec", "test_rec",
              "test_gmean", "test_f1", "test_mcc", "test_time"]
print(df.shape)

cvss = df["problem"].unique()
print(cvss)

df = df.sort_values('test_mcc', ascending=False)
# for c in cvss:
#     tmp = df[df["problem"] == c].groupby(['problem', 'classifier', 'feature'])['test_mcc'].max()
#     print(tmp)

idx = df.groupby(['problem', 'classifier', 'feature'])['test_mcc'].transform(max) == df['test_mcc']
print(df[idx])

# tmp = df[df["problem"] == "access_vector"].groupby(['problem', 'classifier', 'feature'])['test_mcc'].idxmax()
# print(tmp)
# print(df[df["problem"] == "access_vector"].loc[tmp])
